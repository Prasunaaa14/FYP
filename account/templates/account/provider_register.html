{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Apply as Provider | HomeService</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="{% static 'account/provider_register.css' %}">
</head>
<body>

<div class="register-wrapper">

  <!-- LEFT PANEL -->
  <div class="register-left">
    <div class="logo-box">H</div>
    <h2>Join as a Service Provider</h2>
    <p>
      Showcase your skills, upload your certifications,
      and start earning by helping customers near you.
    </p>
  </div>

  <!-- RIGHT PANEL -->
  <div class="register-right">
    <h1>Create a provider account</h1>
    <p class="subtitle">Apply to offer your services on HomeService</p>

    <!-- TOGGLE -->
    <div class="role-toggle">
      <a href="{% url 'register' %}">I need services</a>
      <button type="button" class="active">I provide services</button>
    </div>

    <!-- MESSAGES -->
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-box">
            <strong><i class="bi bi-exclamation-circle"></i> {{ message }}</strong>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form class="register-form" method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- FULL NAME -->
      <label>Full Name</label>
      <div class="input-group">
        <i class="bi bi-person"></i>
        <input type="text" name="full_name" placeholder="Enter your full name" value="{{ request.POST.full_name }}" required>
      </div>

      <!-- EMAIL -->
      <label>Email</label>
      <div class="input-group">
        <i class="bi bi-envelope"></i>
        <input type="email" name="email" placeholder="Enter your email" value="{{ request.POST.email }}" required>
      </div>
      {% if form.email.errors %}
        <div class="field-error">
          {% for error in form.email.errors %}
            <small style="color: #dc2626;">{{ error }}</small>
          {% endfor %}
        </div>
      {% endif %}

      <!-- PHONE -->
      <label>Phone Number</label>
      <div class="input-group">
        <i class="bi bi-telephone"></i>
        <input type="tel" name="phone" placeholder="Enter your phone number" value="{{ request.POST.phone }}" required>
      </div>
      {% if form.phone.errors %}
        <div class="field-error">
          {% for error in form.phone.errors %}
            <small style="color: #dc2626;">{{ error }}</small>
          {% endfor %}
        </div>
      {% endif %}

      <!-- SERVICE CATEGORIES -->
      <label>Service Categories (Select One or More)</label>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="plumbing"> Plumbing
        </label>
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="electrical"> Electrical
        </label>
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="cleaning"> Cleaning
        </label>
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="carpentry"> Carpentry
        </label>
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="painting"> Painting
        </label>
        <label class="checkbox-label">
          <input type="checkbox" name="service_categories" value="ac_repair"> AC Repair
        </label>
      </div>
      <small style="color: #f97316; font-size: 12px; display: block; margin-bottom: 16px; font-weight: 500;">
        <i class="bi bi-exclamation-triangle"></i> Important: Upload one certificate for each category you select (e.g., 2 categories = 2 certificates)
      </small>

      <!-- EXPERIENCE -->
      <label>Experience (Years)</label>
      <div class="input-group">
        <i class="bi bi-clock-history"></i>
        <input type="number" name="experience" min="0" placeholder="e.g. 3" required>
      </div>

      <!-- CERTIFICATES -->
      <label>Upload Certificates (One for Each Category)</label>
      <div class="file-upload">
        <input
          type="file"
          id="certificateInput"
          name="certificates"
          accept=".pdf,.jpg,.jpeg,.png"
          multiple="multiple"
          required
        >
        <small>
          Accepted formats: PDF, JPG, PNG. You can add files in multiple picks - we'll keep them all here (Ctrl/Shift lets you multi-select in one pick).
        </small>
        <div id="fileList" style="margin-top: 10px; font-size: 13px; color: #059669;"></div>
      </div>

      <!-- PASSWORD -->
      <label>Password</label>
      <div class="input-group">
        <i class="bi bi-lock"></i>
        <input
          type="password"
          id="providerPassword"
          name="password"
          placeholder="Create a password (min 8 characters)"
          required
        >
        <i class="bi bi-eye eye-icon" onclick="togglePassword()" id="passwordEye"></i>
      </div>
      {% if form.password.errors %}
        <div class="field-error">
          {% for error in form.password.errors %}
            <small style="color: #dc2626;">{{ error }}</small>
          {% endfor %}
        </div>
      {% endif %}
      <small style="color: #64748b; font-size: 12px; margin-top: -12px; display: block; margin-bottom: 16px;">
        Must include: uppercase, lowercase, number, and special character
      </small>

      <!-- CONFIRM PASSWORD -->
      <label>Confirm Password</label>
      <div class="input-group">
        <i class="bi bi-lock"></i>
        <input
          type="password"
          id="confirmProviderPassword"
          name="confirm_password"
          placeholder="Re-enter your password"
          required
        >
        <i class="bi bi-eye eye-icon" onclick="toggleConfirmPassword()" id="confirmPasswordEye"></i>
      </div>
      {% if form.confirm_password.errors %}
        <div class="field-error">
          {% for error in form.confirm_password.errors %}
            <small style="color: #dc2626;">{{ error }}</small>
          {% endfor %}
        </div>
      {% endif %}

      <!-- SUBMIT -->
      <button type="submit" class="submit-btn">
        Apply as Provider â†’
      </button>

      <!-- TERMS -->
      <p class="terms">
        By creating an account, you agree to our
        <a href="#">Terms of Service</a> and
        <a href="#">Privacy Policy</a>
      </p>

      <!-- LOGIN -->
      <p class="login-link">
        Already have an account? <a href="{% url 'login' %}">Log in</a>
      </p>
    </form>
  </div>

</div>

<!-- PASSWORD TOGGLE SCRIPT -->
<script>
function togglePassword() {
    const passwordInput = document.getElementById("providerPassword");
    const eyeIcon = document.getElementById("passwordEye");

    if (passwordInput.type === "password") {
        passwordInput.type = "text";
        eyeIcon.classList.remove("bi-eye");
        eyeIcon.classList.add("bi-eye-slash");
    } else {
        passwordInput.type = "password";
        eyeIcon.classList.remove("bi-eye-slash");
        eyeIcon.classList.add("bi-eye");
    }
}

function toggleConfirmPassword() {
    const confirmInput = document.getElementById("confirmProviderPassword");
    const eyeIcon = document.getElementById("confirmPasswordEye");

    if (confirmInput.type === "password") {
        confirmInput.type = "text";
        eyeIcon.classList.remove("bi-eye");
        eyeIcon.classList.add("bi-eye-slash");
    } else {
        confirmInput.type = "password";
        eyeIcon.classList.remove("bi-eye-slash");
        eyeIcon.classList.add("bi-eye");
    }
}

// Allow multiple file picks and accumulate selections
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('certificateInput');
  const fileList = document.getElementById('fileList');
  if (!fileInput || !fileList) return;

  const dt = new DataTransfer(); // holds all selected files across picks

  function renderFiles() {
    const files = dt.files;
    if (!files.length) {
      fileList.innerHTML = '';
      return;
    }

    let fileNames = '<strong><i class="bi bi-check-circle"></i> Selected files (' + files.length + '):</strong><br>';
    Array.from(files).forEach((file, idx) => {
      fileNames += '<i class="bi bi-file-earmark"></i> ' + (idx + 1) + '. ' + file.name + '<br>';
    });
    fileList.innerHTML = fileNames;
  }

  fileInput.addEventListener('change', function(e) {
    const newFiles = e.target.files;
    if (!newFiles || !newFiles.length) return;

    Array.from(newFiles).forEach(file => {
      const exists = Array.from(dt.files).some(f => (
        f.name === file.name &&
        f.size === file.size &&
        f.lastModified === file.lastModified
      ));
      if (!exists) {
        dt.items.add(file);
      }
    });

    // Update the actual input's FileList and refresh UI
    fileInput.files = dt.files;
    renderFiles();
  });

  // Ensure accumulated files are present on submit
  fileInput.form?.addEventListener('submit', function() {
    fileInput.files = dt.files;
  });
});
</script>

</body>
</html>
