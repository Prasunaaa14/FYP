{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Provider Dashboard | HomeService</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{% static 'account/css/dashboard.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="navbar">
    <div class="logo">
        <div class="logo-box">H</div>
        <span>HomeService</span>
    </div>

    <div class="user-info">
        <div class="user-text">
            <strong>{{ request.user.first_name }}</strong>
            <span>Service Provider
                {% if request.user.profile.is_verified %}
                <span class="verified-badge-small">‚úì Verified</span>
                {% endif %}
            </span>
        </div>
        <a href="{% url 'logout' %}" class="logout">‚Ü™</a>
    </div>
</header>

<main class="container">

    <h1>Welcome back, {{ request.user.first_name }}!</h1>
    <p class="subtitle">
        Manage your services, bookings, and customers.
    </p>

    <div class="actions">
<a href="#job-requests" class="btn primary">üìã View Requests</a>
        <a href="{% url 'provider_services' %}" class="btn">üõ† My Services</a>
        <button class="btn">üí¨ Messages</button>
        <button class="btn">‚öô Settings</button>
    </div>

    <!-- ================= STATS ================= -->
    <section class="stats">
        <div class="card">
            <p class="card-title">New Requests</p>
            <h2>{{ bookings|length }}</h2>
            <small>Pending approvals</small>
        </div>

        <div class="card">
            <p class="card-title">Active Jobs</p>
            <h2>{{ bookings|length }}</h2>
            <small>Ongoing work</small>
        </div>

        <div class="card">
            <p class="card-title">Completed Jobs</p>
            <h2>
                {{ bookings|dictsort:"status"|length }}
            </h2>
            <small>Total completed</small>
        </div>

        <div class="card">
            <p class="card-title">Messages</p>
            <h2>0</h2>
            <small>Unread messages</small>
        </div>
    </section>

    <!-- ================= BOOKINGS ================= -->
    <section class="bookings">
        <h2>Your Job Requests</h2>

        {% if bookings %}
            <div class="bookings-list">
                {% for booking in bookings %}
                {% if booking.status != "cancelled" %}
                <div class="booking-card">
                    <!-- Card Header with Service Icon -->
                    <div class="card-top">
                        <div class="service-icon">üîß</div>
                        <div class="card-title-section">
                            <h3 class="service-name">{{ booking.service.name }}</h3>
                            <span class="category-badge">{{ booking.service.get_category_display }}</span>
                        </div>
                        <span class="status status-{{ booking.status }}">{{ booking.get_status_display }}</span>
                    </div>

                    <!-- Customer Info -->
                    <div class="provider-info">
                        <div class="provider-avatar">üë§</div>
                        <div class="provider-details">
                            <p class="provider-label">Customer</p>
                            <p class="provider-name">{{ booking.customer.get_full_name }}</p>
                        </div>
                    </div>

                    <!-- Booking Info Grid -->
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">üí∞ Price</span>
                            <span class="info-value">Rs. {{ booking.service.price }}</span>
                        </div>
                        {% if booking.booking_time %}
                        <div class="info-item">
                            <span class="info-label">‚è∞ Time</span>
                            <span class="info-value">{{ booking.booking_time }}</span>
                        </div>
                        {% endif %}
                        {% if booking.location %}
                        <div class="info-item">
                            <span class="info-label">üìç Location</span>
                            <span class="info-value">{{ booking.location }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Booking Date -->
                    <div class="booking-date">
                        <span>üìÖ Requested on {{ booking.created_at|date:"M d, Y" }} at {{ booking.created_at|time:"H:i" }}</span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="card-actions">
                        {% if booking.status == "pending" %}
                        <form method="POST" action="{% url 'update_booking_status' booking.id %}" style="display: flex; gap: 12px; width: 100%;">
                            {% csrf_token %}
                            <button type="submit" name="action" value="approve" class="btn-approve">‚úÖ Approve</button>
                            <button type="submit" name="action" value="reject" class="btn-cancel" onclick="return confirm('Are you sure you want to reject this booking?');">‚ùå Reject</button>
                        </form>
                        {% else %}
                        <a href="{% url 'view_messages' booking.id %}" class="btn-secondary" style="text-decoration: none; text-align: center;">üí¨ Message Customer</a>
                        <button class="btn-secondary">üìû Contact</button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="home-icon">üõ†</div>
                <p class="empty-title">No job requests yet</p>
                <p class="empty-text">
                    Once customers request your services, they‚Äôll appear here.
                </p>
<a href="{% url 'add_service' %}" class="btn primary">Add Services</a>
            </div>
        {% endif %}
    </section>

</main>

</body>
</html>
